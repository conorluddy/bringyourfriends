<!DOCTYPE html>

<html>
<head>
  <title>liftapp.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="friends.html">
                friends.js
              </a>
            
              
              <a class="source" href="init.html">
                init.js
              </a>
            
              
              <a class="source" href="notifications.html">
                notifications.js
              </a>
            
              
              <a class="source" href="setMsg.html">
                setMsg.js
              </a>
            
              
              <a class="source" href="story.html">
                story.js
              </a>
            
              
              <a class="source" href="trip.html">
                trip.js
              </a>
            
              
              <a class="source" href="liftapp.html">
                liftapp.js
              </a>
            
              
              <a class="source" href="locate.html">
                locate.js
              </a>
            
              
              <a class="source" href="marker.html">
                marker.js
              </a>
            
              
              <a class="source" href="directions.html">
                directions.js
              </a>
            
              
              <a class="source" href="initialise.html">
                initialise.js
              </a>
            
              
              <a class="source" href="styles.html">
                styles.js
              </a>
            
              
              <a class="source" href="helper.html">
                helper.js
              </a>
            
              
              <a class="source" href="plugins.html">
                plugins.js
              </a>
            
              
              <a class="source" href="coordinates.html">
                coordinates.js
              </a>
            
              
              <a class="source" href="friends.html">
                friends.js
              </a>
            
              
              <a class="source" href="invitees.html">
                invitees.js
              </a>
            
              
              <a class="source" href="marker.html">
                marker.js
              </a>
            
              
              <a class="source" href="message.html">
                message.js
              </a>
            
              
              <a class="source" href="notifications.html">
                notifications.js
              </a>
            
              
              <a class="source" href="trip.html">
                trip.js
              </a>
            
              
              <a class="source" href="ui.html">
                ui.js
              </a>
            
              
              <a class="source" href="jquery.mobile-1.4.2.html">
                jquery.mobile-1.4.2.js
              </a>
            
              
              <a class="source" href="jquery.mobile-1.4.2.min.html">
                jquery.mobile-1.4.2.min.js
              </a>
            
              
              <a class="source" href="modernizr-2.6.2.min.html">
                modernizr-2.6.2.min.js
              </a>
            
              
              <a class="source" href="zepto.min.html">
                zepto.min.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>liftapp.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! LiftApp - v0.0.1 - 2014-03-21

*/</span><span class="hljs-comment">/**
 * MBP - Mobile boilerplate helper functions
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(document)</span> {</span>

    window.MBP = window.MBP || {};

    <span class="hljs-comment">/**
     * Fix for iPhone viewport scale bug
     * http://www.blog.highub.com/mobile-2/a-fix-for-iphone-viewport-scale-bug/
     */</span>

    MBP.viewportmeta = document.querySelector &amp;&amp; document.querySelector(<span class="hljs-string">'meta[name="viewport"]'</span>);
    MBP.ua = navigator.userAgent;

    MBP.scaleFix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">if</span> (MBP.viewportmeta &amp;&amp; <span class="hljs-regexp">/iPhone|iPad|iPod/</span>.test(MBP.ua) &amp;&amp; !<span class="hljs-regexp">/Opera Mini/</span>.test(MBP.ua)) {
            MBP.viewportmeta.content = <span class="hljs-string">'width=device-width, minimum-scale=1.0, maximum-scale=1.0'</span>;
            document.addEventListener(<span class="hljs-string">'gesturestart'</span>, MBP.gestureStart, <span class="hljs-literal">false</span>);
        }
    };

    MBP.gestureStart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        MBP.viewportmeta.content = <span class="hljs-string">'width=device-width, minimum-scale=0.25, maximum-scale=1.6'</span>;
    };

    <span class="hljs-comment">/**
     * Normalized hide address bar for iOS &amp; Android
     * (c) Scott Jehl, scottjehl.com
     * MIT License
     */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>If we split this up into two functions we can reuse
this function if we aren’t doing full page reloads.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>If we cache this we don’t need to re-calibrate everytime we call
the hide url bar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MBP.BODY_SCROLL_TOP = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>So we don’t redefine this function everytime we
we call hideUrlBar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MBP.getScrollTop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> win = window;
        <span class="hljs-keyword">var</span> doc = document;

        <span class="hljs-keyword">return</span> win.pageYOffset || doc.compatMode === <span class="hljs-string">'CSS1Compat'</span> &amp;&amp; doc.documentElement.scrollTop || doc.body.scrollTop || <span class="hljs-number">0</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>It should be up to the mobile</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MBP.hideUrlBar = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> win = window;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>if there is a hash, or MBP.BODY_SCROLL_TOP hasn’t been set yet, wait till that happens</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!location.hash &amp;&amp; MBP.BODY_SCROLL_TOP !== <span class="hljs-literal">false</span>) {
            win.scrollTo( <span class="hljs-number">0</span>, MBP.BODY_SCROLL_TOP === <span class="hljs-number">1</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span> );
        }
    };

    MBP.hideUrlBarOnLoad = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> win = window;
        <span class="hljs-keyword">var</span> doc = win.document;
        <span class="hljs-keyword">var</span> bodycheck;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If there’s a hash, or addEventListener is undefined, stop here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( !location.hash &amp;&amp; win.addEventListener ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>scroll to 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.scrollTo( <span class="hljs-number">0</span>, <span class="hljs-number">1</span> );
            MBP.BODY_SCROLL_TOP = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>reset to 0 on bodyready, if needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            bodycheck = setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                <span class="hljs-keyword">if</span> ( doc.body ) {
                    clearInterval( bodycheck );
                    MBP.BODY_SCROLL_TOP = MBP.getScrollTop();
                    MBP.hideUrlBar();
                }
            }, <span class="hljs-number">15</span> );

            win.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>at load, if user hasn’t scrolled more than 20 or so…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (MBP.getScrollTop() &lt; <span class="hljs-number">20</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>reset to hide addr bar at onload</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        MBP.hideUrlBar();
                    }
                }, <span class="hljs-number">0</span>);
            });
        }
    };

    <span class="hljs-comment">/**
     * Fast Buttons - read wiki below before using
     * https://github.com/h5bp/mobile-boilerplate/wiki/JavaScript-Helper
     */</span>

    MBP.fastButton = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element, handler, pressedClass)</span> {</span>
        <span class="hljs-keyword">this</span>.handler = handler;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>styling of .pressed is defined in the project’s CSS files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.pressedClass = <span class="hljs-keyword">typeof</span> pressedClass === <span class="hljs-string">'undefined'</span> ? <span class="hljs-string">'pressed'</span> : pressedClass;

        <span class="hljs-keyword">if</span> (element.length &amp;&amp; element.length &gt; <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> singleElIdx <span class="hljs-keyword">in</span> element) {
                <span class="hljs-keyword">this</span>.addClickEvent(element[singleElIdx]);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.addClickEvent(element);
        }
    };

    MBP.fastButton.prototype.handleEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
        event = event || window.event;

        <span class="hljs-keyword">switch</span> (event.type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'touchstart'</span>: <span class="hljs-keyword">this</span>.onTouchStart(event); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'touchmove'</span>: <span class="hljs-keyword">this</span>.onTouchMove(event); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'touchend'</span>: <span class="hljs-keyword">this</span>.onClick(event); <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'click'</span>: <span class="hljs-keyword">this</span>.onClick(event); <span class="hljs-keyword">break</span>;
        }
    };

    MBP.fastButton.prototype.onTouchStart = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
        <span class="hljs-keyword">var</span> element = event.target || event.srcElement;
        event.stopPropagation();
        element.addEventListener(<span class="hljs-string">'touchend'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
        document.body.addEventListener(<span class="hljs-string">'touchmove'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">this</span>.startX = event.touches[<span class="hljs-number">0</span>].clientX;
        <span class="hljs-keyword">this</span>.startY = event.touches[<span class="hljs-number">0</span>].clientY;

        element.className+= <span class="hljs-string">' '</span> + <span class="hljs-keyword">this</span>.pressedClass;
    };

    MBP.fastButton.prototype.onTouchMove = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(event.touches[<span class="hljs-number">0</span>].clientX - <span class="hljs-keyword">this</span>.startX) &gt; <span class="hljs-number">10</span> ||
            <span class="hljs-built_in">Math</span>.abs(event.touches[<span class="hljs-number">0</span>].clientY - <span class="hljs-keyword">this</span>.startY) &gt; <span class="hljs-number">10</span>) {
            <span class="hljs-keyword">this</span>.reset(event);
        }
    };

    MBP.fastButton.prototype.onClick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
        event = event || window.event;
        <span class="hljs-keyword">var</span> element = event.target || event.srcElement;
        <span class="hljs-keyword">if</span> (event.stopPropagation) {
            event.stopPropagation();
        }
        <span class="hljs-keyword">this</span>.reset(event);
        <span class="hljs-keyword">this</span>.handler.apply(event.currentTarget, [event]);
        <span class="hljs-keyword">if</span> (event.type == <span class="hljs-string">'touchend'</span>) {
            MBP.preventGhostClick(<span class="hljs-keyword">this</span>.startX, <span class="hljs-keyword">this</span>.startY);
        }
        <span class="hljs-keyword">var</span> pattern = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">' ?'</span> + <span class="hljs-keyword">this</span>.pressedClass, <span class="hljs-string">'gi'</span>);
        element.className = element.className.replace(pattern, <span class="hljs-string">''</span>);
    };

    MBP.fastButton.prototype.reset = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
        <span class="hljs-keyword">var</span> element = event.target || event.srcElement;
        rmEvt(element, <span class="hljs-string">'touchend'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
        rmEvt(document.body, <span class="hljs-string">'touchmove'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);

        <span class="hljs-keyword">var</span> pattern = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">' ?'</span> + <span class="hljs-keyword">this</span>.pressedClass, <span class="hljs-string">'gi'</span>);
        element.className = element.className.replace(pattern, <span class="hljs-string">''</span>);
    };

    MBP.fastButton.prototype.addClickEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> {</span>
        addEvt(element, <span class="hljs-string">'touchstart'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
        addEvt(element, <span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
    };

    MBP.preventGhostClick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x, y)</span> {</span>
        MBP.coords.push(x, y);
        window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            MBP.coords.splice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);
        }, <span class="hljs-number">2500</span>);
    };

    MBP.ghostClickHandler = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
        <span class="hljs-keyword">if</span> (!MBP.hadTouchEvent &amp;&amp; MBP.dodgyAndroid) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This is a bit of fun for Android 2.3…
If you change window.location via fastButton, a click event will fire
on the new page, as if the events are continuing from the previous page.
We pick that event up here, but MBP.coords is empty, because it’s a new page,
so we don’t prevent it. Here’s we’re assuming that click events on touch devices
that occur without a preceding touchStart are to be ignored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            event.stopPropagation();
            event.preventDefault();
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = MBP.coords.length; i &lt; len; i += <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">var</span> x = MBP.coords[i];
            <span class="hljs-keyword">var</span> y = MBP.coords[i + <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(event.clientX - x) &lt; <span class="hljs-number">25</span> &amp;&amp; <span class="hljs-built_in">Math</span>.abs(event.clientY - y) &lt; <span class="hljs-number">25</span>) {
                event.stopPropagation();
                event.preventDefault();
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>This bug only affects touch Android 2.3 devices, but a simple ontouchstart test creates a false positive on
some Blackberry devices. <a href="https://github.com/Modernizr/Modernizr/issues/372">https://github.com/Modernizr/Modernizr/issues/372</a>
The browser sniffing is to avoid the Blackberry case. Bah</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    MBP.dodgyAndroid = (<span class="hljs-string">'ontouchstart'</span> <span class="hljs-keyword">in</span> window) &amp;&amp; (navigator.userAgent.indexOf(<span class="hljs-string">'Android 2.3'</span>) != -<span class="hljs-number">1</span>);

    <span class="hljs-keyword">if</span> (document.addEventListener) {
        document.addEventListener(<span class="hljs-string">'click'</span>, MBP.ghostClickHandler, <span class="hljs-literal">true</span>);
    }

    addEvt(document.documentElement, <span class="hljs-string">'touchstart'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        MBP.hadTouchEvent = <span class="hljs-literal">true</span>;
    }, <span class="hljs-literal">false</span>);

    MBP.coords = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>fn arg can be an object or a function, thanks to handleEvent
read more about the explanation at: <a href="http://www.thecssninja.com/javascript/handleevent">http://www.thecssninja.com/javascript/handleevent</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addEvt</span><span class="hljs-params">(el, evt, fn, bubble)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'addEventListener'</span> <span class="hljs-keyword">in</span> el) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>BBOS6 doesn’t support handleEvent, catch and polyfill</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">try</span> {
                el.addEventListener(evt, fn, bubble);
            } <span class="hljs-keyword">catch</span>(e) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn == <span class="hljs-string">'object'</span> &amp;&amp; fn.handleEvent) {
                    el.addEventListener(evt, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Bind fn as this and set first arg as event object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        fn.handleEvent.call(fn,e);
                    }, bubble);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> e;
                }
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">'attachEvent'</span> <span class="hljs-keyword">in</span> el) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>check if the callback is an object and contains handleEvent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn == <span class="hljs-string">'object'</span> &amp;&amp; fn.handleEvent) {
                el.attachEvent(<span class="hljs-string">'on'</span> + evt, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Bind fn as this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    fn.handleEvent.call(fn);
                });
            } <span class="hljs-keyword">else</span> {
                el.attachEvent(<span class="hljs-string">'on'</span> + evt, fn);
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rmEvt</span><span class="hljs-params">(el, evt, fn, bubble)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'removeEventListener'</span> <span class="hljs-keyword">in</span> el) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>BBOS6 doesn’t support handleEvent, catch and polyfill</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">try</span> {
                el.removeEventListener(evt, fn, bubble);
            } <span class="hljs-keyword">catch</span>(e) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn == <span class="hljs-string">'object'</span> &amp;&amp; fn.handleEvent) {
                    el.removeEventListener(evt, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>{</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Bind fn as this and set first arg as event object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        fn.handleEvent.call(fn,e);
                    }, bubble);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> e;
                }
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">'detachEvent'</span> <span class="hljs-keyword">in</span> el) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>check if the callback is an object and contains handleEvent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn == <span class="hljs-string">'object'</span> &amp;&amp; fn.handleEvent) {
                el.detachEvent(<span class="hljs-string">"on"</span> + evt, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Bind fn as this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    fn.handleEvent.call(fn);
                });
            } <span class="hljs-keyword">else</span> {
                el.detachEvent(<span class="hljs-string">'on'</span> + evt, fn);
            }
        }
    }

    <span class="hljs-comment">/**
     * Autogrow
     * http://googlecode.blogspot.com/2009/07/gmail-for-mobile-html5-series.html
     */</span>

    MBP.autogrow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element, lh)</span> {</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handler</span><span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">var</span> newHeight = <span class="hljs-keyword">this</span>.scrollHeight;
            <span class="hljs-keyword">var</span> currentHeight = <span class="hljs-keyword">this</span>.clientHeight;
            <span class="hljs-keyword">if</span> (newHeight &gt; currentHeight) {
                <span class="hljs-keyword">this</span>.style.height = newHeight + <span class="hljs-number">3</span> * textLineHeight + <span class="hljs-string">'px'</span>;
            }
        }

        <span class="hljs-keyword">var</span> setLineHeight = (lh) ? lh : <span class="hljs-number">12</span>;
        <span class="hljs-keyword">var</span> textLineHeight = element.currentStyle ? element.currentStyle.lineHeight : getComputedStyle(element, <span class="hljs-literal">null</span>).lineHeight;

        textLineHeight = (textLineHeight.indexOf(<span class="hljs-string">'px'</span>) == -<span class="hljs-number">1</span>) ? setLineHeight : <span class="hljs-built_in">parseInt</span>(textLineHeight, <span class="hljs-number">10</span>);

        element.style.overflow = <span class="hljs-string">'hidden'</span>;
        element.addEventListener ? element.addEventListener(<span class="hljs-string">'input'</span>, handler, <span class="hljs-literal">false</span>) : element.attachEvent(<span class="hljs-string">'onpropertychange'</span>, handler);
    };

    <span class="hljs-comment">/**
     * Enable CSS active pseudo styles in Mobile Safari
     * http://alxgbsn.co.uk/2011/10/17/enable-css-active-pseudo-styles-in-mobile-safari/
     */</span>

    MBP.enableActive = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        document.addEventListener(<span class="hljs-string">'touchstart'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>}, <span class="hljs-literal">false</span>);
    };

    <span class="hljs-comment">/**
     * Prevent default scrolling on document window
     */</span>
     
    MBP.preventScrolling = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        document.addEventListener(<span class="hljs-string">'touchmove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
            <span class="hljs-keyword">if</span> (e.target.type === <span class="hljs-string">'range'</span>) { <span class="hljs-keyword">return</span>; }
            e.preventDefault();
        }, <span class="hljs-literal">false</span>);
    };

    <span class="hljs-comment">/**
     * Prevent iOS from zooming onfocus
     * https://github.com/h5bp/mobile-boilerplate/pull/108
     * Adapted from original jQuery code here: http://nerd.vasilis.nl/prevent-ios-from-zooming-onfocus/
     */</span>

    MBP.preventZoom = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> formFields = document.querySelectorAll(<span class="hljs-string">'input, select, textarea'</span>);
        <span class="hljs-keyword">var</span> contentString = <span class="hljs-string">'width=device-width,initial-scale=1,maximum-scale='</span>;
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; formFields.length; i++) {
            formFields[i].onfocus = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                MBP.viewportmeta.content = contentString + <span class="hljs-string">'1'</span>;
            };
            formFields[i].onblur = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
                MBP.viewportmeta.content = contentString + <span class="hljs-string">'10'</span>;
            };
        }
    };

    <span class="hljs-comment">/**
     * iOS Startup Image helper
     */</span>

    MBP.startupImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> portrait;
        <span class="hljs-keyword">var</span> landscape;
        <span class="hljs-keyword">var</span> pixelRatio;
        <span class="hljs-keyword">var</span> head;
        <span class="hljs-keyword">var</span> link1;
        <span class="hljs-keyword">var</span> link2;

        pixelRatio = window.devicePixelRatio;
        head = document.getElementsByTagName(<span class="hljs-string">'head'</span>)[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">if</span> (navigator.platform === <span class="hljs-string">'iPad'</span>) {
            portrait = pixelRatio === <span class="hljs-number">2</span> ? <span class="hljs-string">'img/startup/startup-tablet-portrait-retina.png'</span> : <span class="hljs-string">'img/startup/startup-tablet-portrait.png'</span>;
            landscape = pixelRatio === <span class="hljs-number">2</span> ? <span class="hljs-string">'img/startup/startup-tablet-landscape-retina.png'</span> : <span class="hljs-string">'img/startup/startup-tablet-landscape.png'</span>;

            link1 = document.createElement(<span class="hljs-string">'link'</span>);
            link1.setAttribute(<span class="hljs-string">'rel'</span>, <span class="hljs-string">'apple-touch-startup-image'</span>);
            link1.setAttribute(<span class="hljs-string">'media'</span>, <span class="hljs-string">'screen and (orientation: portrait)'</span>);
            link1.setAttribute(<span class="hljs-string">'href'</span>, portrait);
            head.appendChild(link1);

            link2 = document.createElement(<span class="hljs-string">'link'</span>);
            link2.setAttribute(<span class="hljs-string">'rel'</span>, <span class="hljs-string">'apple-touch-startup-image'</span>);
            link2.setAttribute(<span class="hljs-string">'media'</span>, <span class="hljs-string">'screen and (orientation: landscape)'</span>);
            link2.setAttribute(<span class="hljs-string">'href'</span>, landscape);
            head.appendChild(link2);
        } <span class="hljs-keyword">else</span> {
            portrait = pixelRatio === <span class="hljs-number">2</span> ? <span class="hljs-string">"img/startup/startup-retina.png"</span> : <span class="hljs-string">"img/startup/startup.png"</span>;
            portrait = screen.height === <span class="hljs-number">568</span> ? <span class="hljs-string">"img/startup/startup-retina-4in.png"</span> : portrait;
            link1 = document.createElement(<span class="hljs-string">'link'</span>);
            link1.setAttribute(<span class="hljs-string">'rel'</span>, <span class="hljs-string">'apple-touch-startup-image'</span>);
            link1.setAttribute(<span class="hljs-string">'href'</span>, portrait);
            head.appendChild(link1);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>hack to fix letterboxed full screen web apps on 4” iPhone / iPod</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((navigator.platform === <span class="hljs-string">'iPhone'</span> || <span class="hljs-string">'iPod'</span>) &amp;&amp; (screen.height === <span class="hljs-number">568</span>)) {
            <span class="hljs-keyword">if</span> (MBP.viewportmeta) {
                MBP.viewportmeta.content = MBP.viewportmeta.content
                    .replace(<span class="hljs-regexp">/\bwidth\s*=\s*320\b/</span>, <span class="hljs-string">'width=320.1'</span>)
                    .replace(<span class="hljs-regexp">/\bwidth\s*=\s*device-width\b/</span>, <span class="hljs-string">''</span>);
            }
        }
    };

})(document);

;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Avoid <code>console</code> errors in browsers that lack a console.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> method;
    <span class="hljs-keyword">var</span> noop = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noop</span><span class="hljs-params">()</span> {</span>};
    <span class="hljs-keyword">var</span> methods = [
        <span class="hljs-string">'assert'</span>, <span class="hljs-string">'clear'</span>, <span class="hljs-string">'count'</span>, <span class="hljs-string">'debug'</span>, <span class="hljs-string">'dir'</span>, <span class="hljs-string">'dirxml'</span>, <span class="hljs-string">'error'</span>,
        <span class="hljs-string">'exception'</span>, <span class="hljs-string">'group'</span>, <span class="hljs-string">'groupCollapsed'</span>, <span class="hljs-string">'groupEnd'</span>, <span class="hljs-string">'info'</span>, <span class="hljs-string">'log'</span>,
        <span class="hljs-string">'markTimeline'</span>, <span class="hljs-string">'profile'</span>, <span class="hljs-string">'profileEnd'</span>, <span class="hljs-string">'table'</span>, <span class="hljs-string">'time'</span>, <span class="hljs-string">'timeEnd'</span>,
        <span class="hljs-string">'timeStamp'</span>, <span class="hljs-string">'trace'</span>, <span class="hljs-string">'warn'</span>
    ];
    <span class="hljs-keyword">var</span> length = methods.length;
    <span class="hljs-keyword">var</span> console = (window.console = window.console || {});

    <span class="hljs-keyword">while</span> (length--) {
        method = methods[length];</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Only stub undefined methods.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!console[method]) {
            console[method] = noop;
        }
    }
}());</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Place any Zepto/helper plugins in here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2 id="liftapp-la-">LiftApp (LA)</h2>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Location helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="location-related-methods">Location related methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.store.coordinates = {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>The location of the device</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	ourLocation: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Beginning of the trip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	startLocation: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Destination of the trip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	endLocation: <span class="hljs-literal">null</span>

};


;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="liftapp-la-">LiftApp (LA)</h2>

            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Location helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h2 id="location-related-methods">Location related methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.store.friends = {};






;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h2 id="liftapp-la-">LiftApp (LA)</h2>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Location helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h2 id="location-related-methods">Location related methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.store.invitees = [];






;
<span class="hljs-comment">/*

	LiftApp (LA)
	
	Location helpers

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA)
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};



<span class="hljs-comment">/*
Location related methods
 */</span>
LA.store.marker = {

	icon: {

		startPoint: {
			url: <span class="hljs-string">'img/markers/play.png'</span>,
			size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>),
			origin: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
			anchor: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>),
			scaledSize: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
		},
		dude: {
			url: <span class="hljs-string">'img/markers/dude.png'</span>,
			size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>),
			origin: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
			anchor: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>),
			scaledSize: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
		},
		yellowdot: {
			url: <span class="hljs-string">'img/markers/circle-yellow.png'</span>,
			size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>),
			origin: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
			anchor: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>),
			scaledSize: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
		},
		greendot: {
			url: <span class="hljs-string">'img/markers/circle-green.png'</span>,
			size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>),
			origin: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
			anchor: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>),
			scaledSize: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
		},
		endPoint: {
			url: <span class="hljs-string">'img/markers/finish.png'</span>,
			size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>),
			origin: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
			anchor: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>),
			scaledSize: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)
		},
		defaultMarker: {
			url: <span class="hljs-string">'img/markers/default.png'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>size: new google.maps.Size(32, 32),
origin: new google.maps.Point(0, 0),
anchor: new google.maps.Point(16, 16),
scaledSize: new google.maps.Size(32, 32)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		}


	}

};
;
<span class="hljs-comment">/*

	LiftApp (LA)
	
	Messages /text

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA)
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};



<span class="hljs-comment">/*
Location related methods
 */</span>
LA.store.message = {

	story: {
		step1: <span class="hljs-string">'Pick a starting location'</span>,
		step2: <span class="hljs-string">'Set your destination'</span>
	},

	confirm: {
		step1: <span class="hljs-string">'Use this as your starting point?'</span>,
		step2: <span class="hljs-string">'Use this as your destination?'</span>
	},

	directions: {
		getting: <span class="hljs-string">'Getting directions...'</span>
	},

	friends: {
		pick: <span class="hljs-string">'Pick some passengers'</span>
	},

	btn: {
		y: <span class="hljs-string">'Yup!'</span>,
		n: <span class="hljs-string">'No.'</span>,
		k: <span class="hljs-string">'OK!'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>/////</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		y2: <span class="hljs-string">'Sure'</span>,
		n2: <span class="hljs-string">'No.'</span>,
		k2: <span class="hljs-string">'OK!'</span>
	}

};
;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h2 id="liftapp-la-">LiftApp (LA)</h2>

            </div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Location helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h2 id="location-related-methods">Location related methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.store.notifications = {};






;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <h2 id="liftapp-la-">LiftApp (LA)</h2>

            </div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Save the trip data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h2 id="location-related-methods">Location related methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.store.trip = {

	startLat : <span class="hljs-number">0</span>,
	startLon : <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>	endLat : <span class="hljs-number">0</span>,
	endLon : <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>	startTime : <span class="hljs-number">0</span>,
	etaTime : <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>	invitees : <span class="hljs-literal">null</span>,
	seats : <span class="hljs-number">4</span>, <span class="hljs-comment">//TODO - make option</span></pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>	polyline: <span class="hljs-string">''</span>

};






;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <h2 id="liftapp-la-">LiftApp (LA)</h2>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Location helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>



<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.store === <span class="hljs-string">"undefined"</span> || !LA.store)
	window.LA.store = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <h2 id="location-related-methods">Location related methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.store.ui = {

	
	instruct_panel : <span class="hljs-string">'#panel_instruct'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>instruct_panel_msg : $(‘#panel_instruct h4’),</p>

            </div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>ok_btn : $(‘#panel_instruct a’),</p>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>confirm_panel : $(‘#panel_confirm’),</p>

            </div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>confirm_panel_msg : $(‘#panel_confirm span’),</p>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>yes_btn : $(‘#panel_confirm .Y’),</p>

            </div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>no_btn : $(‘#panel_confirm .N’),</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
	friends_panel : <span class="hljs-string">'#friends_panel'</span>,
	
	friends_panel_list : <span class="hljs-string">'#friends_panel ul'</span>

};
;

<span class="hljs-comment">/*

	LiftApp
	
	Directions

 */</span>

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.maps === <span class="hljs-string">"undefined"</span> || !LA.maps) 
	window.LA.maps = {};




LA.maps.directions = {
	style: {
		polylineOpts: <span class="hljs-keyword">new</span> google.maps.Polyline({
			strokeColor: <span class="hljs-string">'#C1FC00'</span>,
			strokeOpacity: <span class="hljs-number">0.9</span>,
			strokeWeight: <span class="hljs-number">3</span>
		})
	}
};














;

<span class="hljs-comment">/*

	LiftApp
	
	Map methods

 */</span>

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.maps === <span class="hljs-string">"undefined"</span> || !LA.maps) 
	window.LA.maps = {};



<span class="hljs-comment">/*
Initialise the map
*/</span>
LA.maps.initialise = {


		<span class="hljs-comment">/*
		Set up the map
		 */</span>
		map: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span> mapOptions = {
				center: <span class="hljs-keyword">new</span> google.maps.LatLng(-<span class="hljs-number">34.397</span>, <span class="hljs-number">150.644</span>),
				zoom: <span class="hljs-number">17</span>,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				styles: LA.maps.styles
			};

			LA.map = <span class="hljs-keyword">new</span> google.maps.Map(document.getElementById(<span class="hljs-string">"map-canvas"</span>), mapOptions);

		},


		<span class="hljs-comment">/*
		Set up the search box
		 */</span>
		search: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span>
			image,
			marker,
			markers = [],
			map = LA.map,
			input = <span class="hljs-comment">/** @type {HTMLInputElement} */</span> (document.getElementById(<span class="hljs-string">'pac-input'</span>));<span class="hljs-comment">// Create the search box and link it to the UI element.</span>

			map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

			<span class="hljs-keyword">var</span> searchBox = <span class="hljs-keyword">new</span> google.maps.places.SearchBox( <span class="hljs-comment">/** @type {HTMLInputElement} */</span> (input));</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Listen for the event fired when the user selects an item from the
pick list. Retrieve the matching places for that item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			google.maps.event.addListener(searchBox, <span class="hljs-string">'places_changed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

					places = searchBox.getPlaces();

					<span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; markers.length; i++ ) {
						marker = markers[i];
						marker.setMap(<span class="hljs-literal">null</span>);
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>For each place, get the icon, place name, and location.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					markers = [];

					<span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">new</span> google.maps.LatLngBounds();

					<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, place; place = places[i]; i++) {

						image = {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>url: place.icon,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							url: LA.store.marker.icon.defaultMarker,
							size: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">46</span>),
							origin: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
							anchor: <span class="hljs-keyword">new</span> google.maps.Point(<span class="hljs-number">16</span>, <span class="hljs-number">46</span>),
							scaledSize: <span class="hljs-keyword">new</span> google.maps.Size(<span class="hljs-number">32</span>, <span class="hljs-number">46</span>)
						};</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Create a marker for each place.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						marker = <span class="hljs-keyword">new</span> google.maps.Marker({
							map: map,
							icon: image,
							title: place.name,
							position: place.geometry.location
						});

						markers.push(marker);
						bounds.extend(place.geometry.location);


					}

					map.fitBounds(bounds);

			});</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Bias the SearchBox results towards places that are within the bounds of the
current map’s viewport.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			google.maps.event.addListener(map, <span class="hljs-string">'bounds_changed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				<span class="hljs-keyword">var</span> bounds = map.getBounds();
				searchBox.setBounds(bounds);
			});

	}

};














;


<span class="hljs-comment">/*

	LiftApp
	
	Map styles

 */</span>

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA) 
	window.LA = {};
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.maps === <span class="hljs-string">"undefined"</span> || !LA.maps) 
	window.LA.maps = {};



<span class="hljs-comment">/*
Map styling
*/</span>
LA.maps.styles = [{
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"landscape"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}, {
					<span class="hljs-string">"lightness"</span>: <span class="hljs-number">65</span>
				}, {
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"on"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"poi"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}, {
					<span class="hljs-string">"lightness"</span>: <span class="hljs-number">51</span>
				}, {
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"simplified"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"road.highway"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}, {
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"simplified"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"road.arterial"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}, {
					<span class="hljs-string">"lightness"</span>: <span class="hljs-number">30</span>
				}, {
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"on"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"road.local"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}, {
					<span class="hljs-string">"lightness"</span>: <span class="hljs-number">40</span>
				}, {
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"on"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"transit"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}, {
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"simplified"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"administrative.province"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"off"</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"water"</span>,
				<span class="hljs-string">"elementType"</span>: <span class="hljs-string">"labels"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"visibility"</span>: <span class="hljs-string">"on"</span>
				}, {
					<span class="hljs-string">"lightness"</span>: -<span class="hljs-number">25</span>
				}, {
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">100</span>
				}]
			}, {
				<span class="hljs-string">"featureType"</span>: <span class="hljs-string">"water"</span>,
				<span class="hljs-string">"elementType"</span>: <span class="hljs-string">"geometry"</span>,
				<span class="hljs-string">"stylers"</span>: [{
					<span class="hljs-string">"hue"</span>: <span class="hljs-string">"#ffff00"</span>
				}, {
					<span class="hljs-string">"lightness"</span>: -<span class="hljs-number">25</span>
				}, {
					<span class="hljs-string">"saturation"</span>: -<span class="hljs-number">97</span>
				}]
}];






























;
<span class="hljs-comment">/*

	LiftApp (LA)
	
	Location helpers

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.locations === <span class="hljs-string">"undefined"</span> || !LA.locations)
	window.LA.locations = {};



<span class="hljs-comment">/*
Location related methods
 */</span>
LA.locations.locate = {


		<span class="hljs-comment">/*
		Set the start point for the trip	
		 */</span>
		setStartPoint: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

		},




		<span class="hljs-comment">/*
		Set the end point for the trip	
		 */</span>
		setEndPoint: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

		},




		
		<span class="hljs-comment">/*
		Return the coordinates of the users current location if possible
		 */</span>
		getOurLocation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span>
			fallbackLocation = <span class="hljs-keyword">new</span> google.maps.LatLng( <span class="hljs-number">53.27055</span>, -<span class="hljs-number">9.05666</span> ),
			ourLocation,
			browserSupportFlag = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>/</p>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Try W3C Geolocation (Preferred)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> (navigator.geolocation) {
				browserSupportFlag = <span class="hljs-literal">true</span>;

				navigator.geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(position)</span> {</span>

					ourLocation = <span class="hljs-keyword">new</span> google.maps.LatLng( position.coords.latitude, position.coords.longitude );
					
					LA.store.coordinates.ourLocation = ourLocation;
					
					LA.map.setCenter( ourLocation );</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>LA.store.coordinates.startLocation = LA.locations.marker.placeMarker( ourLocation, LA.store.marker.icon.startPoint );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
				}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					LA.map.setCenter( fallbackLocation );	
				});
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Browser doesn’t support Geolocation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">else</span> {
				LA.map.setCenter( fallbackLocation );
			}	

		}
};





















;

<span class="hljs-comment">/*

	LiftApp
	
	Location helpers

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.locations === <span class="hljs-string">"undefined"</span> || !LA.locations) 
	window.LA.locations = {};




<span class="hljs-comment">/*
Marker related methods
*/</span>
LA.locations.marker = {


		<span class="hljs-comment">/*
		Place a marker on a location
		*/</span>
		placeMarker: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( location, icon )</span> {</span>

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> icon === <span class="hljs-string">'undefined'</span> ) icon = LA.store.marker.icon.defaultMarker;

			<span class="hljs-keyword">var</span> marker = <span class="hljs-keyword">new</span> google.maps.Marker({

				position: location,
				map: LA.map,
				icon: icon

			});

			<span class="hljs-keyword">return</span> marker;

		},

		placeFriendMarker: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( location, icon, friend )</span> {</span>

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> icon === <span class="hljs-string">'undefined'</span> ) icon = LA.store.marker.icon.defaultMarker;

			<span class="hljs-keyword">var</span> marker = <span class="hljs-keyword">new</span> google.maps.Marker({

				position: location,
				map: LA.map,
				icon: icon,
				friend: friend,
				activated: <span class="hljs-literal">false</span> <span class="hljs-comment">//Toggles when marker is selected</span>

			});

			<span class="hljs-keyword">return</span> marker;

		}




};
;

<span class="hljs-comment">/*

	LiftApp
	
	Update messages on the UI

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA ) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.controller === <span class="hljs-string">"undefined"</span> || !LA.controller) 
	window.LA.controller = {};




LA.controller.trip = {

	updateTripForm : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

		<span class="hljs-keyword">var</span>
		inviteeIDs = <span class="hljs-string">""</span>,
		first = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Start point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">'#trip-startLat'</span>).val( LA.store.coordinates.startLocation.lat );
		$(<span class="hljs-string">'#trip-startLon'</span>).val( LA.store.coordinates.startLocation.lon );</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>End point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">'#trip-endLat'</span>).val( LA.store.coordinates.endLocation.lat );
		$(<span class="hljs-string">'#trip-endLon'</span>).val( LA.store.coordinates.endLocation.lon );</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Hopefully we can use this to trace a route on the static maps…TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(<span class="hljs-string">'#trip-polyline'</span>).val( LA.store.trip.polyline );</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Create Invitees ID string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$(LA.store.invitees).each( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, invitee)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Add a comma if it’s not the first ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			inviteeIDs += first ? <span class="hljs-string">''</span> : <span class="hljs-string">','</span>;
			inviteeIDs += invitee.id;
			first = <span class="hljs-literal">false</span>;
		});		

		$(<span class="hljs-string">'#trip-invitees'</span>).val( inviteeIDs );</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>$(‘#trip-startTime’).val(  );
$(‘#trip-etaTime’).val(  );
$(‘#trip-seats’).val(  );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	}

};



;</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <h2 id="liftapp">LiftApp</h2>
<p>App control methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA ) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.controller === <span class="hljs-string">"undefined"</span> || !LA.controller) 
	window.LA.controller = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <h2 id="initialise-the-application">Initialise the application</h2>

            </div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>LA.controller.story = {</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <h2 id="get-the-starting-point-of-the-trip">Get the starting point of the trip</h2>

            </div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>1) Set your starting location</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		askForStartLocation : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span> 
			startLocationListener,
			UI = LA.store.ui;</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Set the user messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$( UI.instruct_panel ).html( <span class="hljs-string">'&lt;h4&gt;'</span> + LA.store.message.story.step1 + <span class="hljs-string">'&lt;/h4&gt;'</span> );
			$.mobile.resetActivePageHeight();</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Add map listener to get the location requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			startLocationListener = google.maps.event.addListener( LA.map, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>	
				google.maps.event.removeListener( startLocationListener );

				$( <span class="hljs-string">'&lt;div data-role="navbar"&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="#" class="Y"&gt;Confirm&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="#" class="N"&gt;Cancel&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;'</span> )
					.prependTo( UI.instruct_panel )
					.navbar();</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Update the page height and padding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$.mobile.resetActivePageHeight();

				setTriggers( $( UI.instruct_panel ).find(<span class="hljs-string">'.Y'</span>), $( UI.instruct_panel ).find(<span class="hljs-string">'.N'</span>) );</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Clear any saved marker for this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( LA.store.coordinates.startLocation !== <span class="hljs-literal">null</span>)
					LA.store.coordinates.startLocation.setMap(<span class="hljs-literal">null</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Add marker for the last clicked/tapped location</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				LA.store.coordinates.startLocation = LA.locations.marker.placeMarker( event.latLng, LA.store.marker.icon.startPoint );
				
				LA.store.coordinates.startLocation.lat = event.latLng.lat();
				LA.store.coordinates.startLocation.lon = event.latLng.lng();
			});

			<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTriggers</span> <span class="hljs-params">( yes_btn, no_btn )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Location is confirmed, move to next step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				yes_btn.one(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
					event.preventDefault();

					<span class="hljs-keyword">if</span> ( LA.store.coordinates.startLocation !== <span class="hljs-literal">null</span>){
						
						window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> 
							LA.controller.story.askForDestinationLocation(); 
						}, <span class="hljs-number">20</span>);

					}
					
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Location is cancelled, remove the marker and wait for new selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				no_btn.one(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
					event.preventDefault();

					LA.store.coordinates.startLocation.setMap(<span class="hljs-literal">null</span>);

					LA.controller.story.askForStartLocation();

				});				
			}

		},</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <h2 id="get-the-destination-point-of-the-trip">Get the destination point of the trip</h2>

            </div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		askForDestinationLocation : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span> 
			destinationLocationListener,
			UI = LA.store.ui;</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Set the user messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$( UI.instruct_panel ).html( <span class="hljs-string">'&lt;h4&gt;'</span> + LA.store.message.story.step2 + <span class="hljs-string">'&lt;/h4&gt;'</span> );
			$( UI.instruct_panel ).toolbar( <span class="hljs-string">"refresh"</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Add map listener to get the location requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			destinationLocationListener = google.maps.event.addListener( LA.map, <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
				google.maps.event.removeListener( destinationLocationListener );

				$( <span class="hljs-string">'&lt;div data-role="navbar"&gt;&lt;ul&gt;&lt;li&gt;&lt;a href="#" class="Y"&gt;Confirm&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href="#" class="N"&gt;Cancel&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;'</span> )
					.prependTo( UI.instruct_panel )
					.navbar();</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Update the page height and padding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$.mobile.resetActivePageHeight();</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>These are added dynamically so we need to find them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				setTriggers( $( UI.instruct_panel ).find(<span class="hljs-string">'.Y'</span>), $( UI.instruct_panel ).find(<span class="hljs-string">'.N'</span>) );</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Clear any saved marker for this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( LA.store.coordinates.endLocation !== <span class="hljs-literal">null</span>)
					LA.store.coordinates.endLocation.setMap(<span class="hljs-literal">null</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Add marker for the last clicked/tapped location</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				LA.store.coordinates.endLocation = LA.locations.marker.placeMarker( event.latLng, LA.store.marker.icon.endPoint );
				LA.store.coordinates.endLocation.lat = event.latLng.lat();
				LA.store.coordinates.endLocation.lon = event.latLng.lng();

			});

			<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTriggers</span> <span class="hljs-params">( yes_btn, no_btn )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Destination is confirmed, move to next step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				yes_btn.one(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
					event.preventDefault();

					<span class="hljs-keyword">if</span> ( LA.store.coordinates.endLocation !== <span class="hljs-literal">null</span>){
					
						window.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> 
							LA.controller.story.getARoute( LA.store.coordinates.startLocation, LA.store.coordinates.endLocation ); 
						}, <span class="hljs-number">300</span>);

					}
					
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Location is cancelled, remove the marker and wait for new selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				no_btn.one(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
					event.preventDefault();

					LA.store.coordinates.endLocation.setMap(<span class="hljs-literal">null</span>);

					LA.controller.story.askForDestinationLocation();

				});
			}

		},</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <h2 id="find-a-route-from-a-to-b">Find a route from A to B</h2>

            </div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		getARoute : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( pointA, pointB )</span> {</span>

			<span class="hljs-keyword">var</span>
			UI = LA.store.ui,
			directionsService = <span class="hljs-keyword">new</span> google.maps.DirectionsService(),
			directionsDisplay = <span class="hljs-keyword">new</span> google.maps.DirectionsRenderer({ polylineOptions: LA.maps.directions.style.polylineOpts });
			directionRequest = {
				origin: pointA.position,
				destination: pointB.position,
				travelMode: google.maps.TravelMode.DRIVING,
				provideRouteAlternatives: <span class="hljs-literal">true</span>
			};</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Set the user messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$( UI.instruct_panel ).html( <span class="hljs-string">'&lt;h4&gt;'</span> + LA.store.message.directions.getting + <span class="hljs-string">'&lt;/h4&gt;'</span> );
			$( UI.instruct_panel ).toolbar( <span class="hljs-string">"refresh"</span> );


			directionsDisplay.setMap(LA.map);

			directionsService.route(directionRequest, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response, status)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Set the user messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$( UI.instruct_panel ).html( <span class="hljs-string">'&lt;h4&gt;'</span> + LA.store.message.friends.pick + <span class="hljs-string">'&lt;/h4&gt;'</span> )
					.prepend(<span class="hljs-string">'&lt;a href="#" id="submit" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-check"&gt;Save Trip&lt;/a&gt;'</span>)
					.toolbar( <span class="hljs-string">"refresh"</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Update the page height and padding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$.mobile.resetActivePageHeight();

				<span class="hljs-keyword">if</span> ( status == google.maps.DirectionsStatus.OK )
					directionsDisplay.setDirections( response );

				<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> response.routes[<span class="hljs-number">0</span>].overview_polyline.points !== <span class="hljs-string">'undefined'</span> ) 
					LA.store.trip.polyline = response.routes[<span class="hljs-number">0</span>].overview_polyline.points;</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Put friends on the map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				LA.controller.friends.showFriends();</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>TODO - move this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				LA.controller.story.doTripSubmit();

			});

		},</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>ToDo - get date and time</p>

            </div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Get the name of the destination</p>

            </div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Get the message to send with the invitation</p>

            </div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Get the number of free seats</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>













		doTripSubmit : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			$(<span class="hljs-string">'#submit'</span>).on( <span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
				event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Put the JS objects in the hidden form fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				LA.controller.trip.updateTripForm();

				$( <span class="hljs-string">"form"</span> ).submit();
			});

		},</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <h2 id="start-the-story">Start the story</h2>

            </div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		init : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
			LA.controller.story.askForStartLocation();
		}

};

















;

<span class="hljs-comment">/*

	LiftApp
	
	Update messages on the UI

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA ) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.controller === <span class="hljs-string">"undefined"</span> || !LA.controller) 
	window.LA.controller = {};




LA.controller.setMsg = {

		instruct: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( msg )</span> {</span>

			LA.store.ui.instruct_panel_msg.html( msg );

		},

		confirm: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( msg )</span> {</span>
			
			LA.store.ui.confirm_panel_msg.html( msg );

		},

		yesBtn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( msg )</span> {</span>
			
			LA.store.ui.yes_btn.html( msg );

		},

		noBtn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( msg )</span> {</span>
			
			LA.store.ui.no_btn.html( msg );

		},

		okBtn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( msg )</span> {</span>
			
			LA.store.ui.ok_btn.html( msg );

		}
};



;

<span class="hljs-comment">/*

	LiftApp
	
	Update messages on the UI

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA ) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.controller === <span class="hljs-string">"undefined"</span> || !LA.controller) 
	window.LA.controller = {};




LA.controller.friends = {</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <h2 id="get-friend-data-json">Get friend data JSON</h2>

            </div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		getJSON : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( )</span> {</span>

			$.getJSON( <span class="hljs-string">"/friends.json"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

				LA.store.friends = data;

			});

		},



		toggleSelectFriend : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span>
			friend = <span class="hljs-keyword">this</span>.friend,
			invitee,
			invitees = LA.store.invitees,
			
			friendPanel = $( LA.store.ui.friends_panel ),
			friendList = $( LA.store.ui.friends_panel_list ),

			idxToRemove = -<span class="hljs-number">1</span>,

			activateFriend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

				friendListItem = $(<span class="hljs-string">'&lt;li data-friendId="'</span> + friend.id + <span class="hljs-string">'"&gt;'</span>+ friend.firstname + <span class="hljs-string">'&lt;/li&gt;'</span>);
				
				friendList.append( friendListItem );
				
				invitees.push( friend );

				friendPanel.trigger( <span class="hljs-string">"updatelayout"</span> );
				friendList.trigger( <span class="hljs-string">"refresh"</span> );

			},
			deactivateFriend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

				invitee = friendList.children(<span class="hljs-string">'li'</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index)</span> {</span> <span class="hljs-keyword">return</span> $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'friendid'</span>) === friend.id; });				
					
				$.each(invitees, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index, val)</span> {</span>
					<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.id === friend.id ){
						idxToRemove = index;
						invitee.remove();
						
						friendPanel.trigger( <span class="hljs-string">"updatelayout"</span> );
						friendList.trigger( <span class="hljs-string">"refresh"</span> );
					}
				});

				<span class="hljs-keyword">if</span> ( idxToRemove &gt; -<span class="hljs-number">1</span> )
					invitees.splice( idxToRemove, <span class="hljs-number">1</span> );
			};

			friendPanel.removeClass(<span class="hljs-string">'away'</span>);<span class="hljs-comment">//TODO: Move this elsewhere</span>

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.activated ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Deactivate    </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>.setIcon( LA.store.marker.icon.yellowdot );
				deactivateFriend();

			} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Activate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">this</span>.setIcon( LA.store.marker.icon.greendot );
				activateFriend();

			}

			<span class="hljs-keyword">this</span>.activated = !<span class="hljs-keyword">this</span>.activated;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Friends should already be stored</p>
<h2 id="show-where-they-are-on-the-map">show where they are on the map</h2>

            </div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		showFriends : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			<span class="hljs-keyword">var</span>
			latlon,
			lat,
			lon;
			

			<span class="hljs-keyword">if</span> ( !LA.store.friends.length ) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Loop through the friends and create markers
then save the marker to the friend object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$.each(LA.store.friends, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(i, friend)</span> {</span>
				
				latlon = friend.latlon.split(<span class="hljs-string">' '</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Temp swap. I probably put these in arseways in the demo data - TODO, swap back</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				lon = latlon[<span class="hljs-number">0</span>];
				lat = latlon[<span class="hljs-number">1</span>];

				latlon = <span class="hljs-keyword">new</span> google.maps.LatLng( lat, lon );

				friend = LA.locations.marker.placeFriendMarker( latlon, LA.store.marker.icon.yellowdot, friend);

				google.maps.event.addListener(friend, <span class="hljs-string">'click'</span>, LA.controller.friends.toggleSelectFriend);
			});
			
		}






};



;

<span class="hljs-comment">/*

	LiftApp
	
	Update messages on the UI

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA ) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.controller === <span class="hljs-string">"undefined"</span> || !LA.controller) 
	window.LA.controller = {};




LA.controller.notifications = {</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <h2 id="get-friend-data-json">Get friend data JSON</h2>

            </div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		getJSON : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( )</span> {</span>

			$.getJSON( <span class="hljs-string">"/invitecount.json"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span> {</span>

				LA.store.notifications.count = data;</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>TODO - make this a regular/live check</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( $(<span class="hljs-string">'header .notifications'</span>).length ) $(<span class="hljs-string">'header .notifications'</span>).html( <span class="hljs-string">'Notifications: '</span> + data );

			});

		}




};



;

<span class="hljs-comment">/*

	LiftApp
	
	App control methods

 */</span>


<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA === <span class="hljs-string">"undefined"</span> || !LA ) 
	window.LA = {};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> LA.controller === <span class="hljs-string">"undefined"</span> || !LA.controller) 
	window.LA.controller = {};




<span class="hljs-comment">/*
Initialise the application 
*/</span>
LA.controller.init = {</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Hook JS to UI elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		ui : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

		},</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Set up the map and an array for the markers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		map : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			LA.markers = [];
			LA.maps.initialise.map();			
			LA.maps.initialise.search();

		},

		locations : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			LA.locations.locate.getOurLocation();
			
		},

		friends : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			LA.controller.friends.getJSON();
			
		},

		notifications : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

			LA.controller.notifications.getJSON();

		}
};





<span class="hljs-comment">/* When doc is ready, run */</span>
jQuery(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($, window, document, undefined)</span> {</span>
<span class="hljs-pi">
	"use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Map page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> ( $(<span class="hljs-string">'#map-canvas'</span>).length ) {
		
		LA.controller.init.map();

		LA.controller.init.locations();

		LA.controller.init.friends();

		LA.controller.init.notifications();

		LA.controller.init.ui();

		LA.controller.story.init();

	}

}(jQuery, window, document));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
